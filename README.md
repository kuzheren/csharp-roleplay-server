# Proton Engine & RP Server

Мой Magnum Opus школьных времен (9 класс, 2023 год).

Проект представляет собой кастомный сетевой движок и реализацию Role Play сервера для игры на Unity. Написан практически с нуля на C#.

Вдохновлен SA:MP.

Главной целью было не только создание игры, не и разработка собственного сетевого протокола, игрового мода и попытка разобраться, как работают онлайн игры: от упаковки байтов в пакеты до синхронизации игровой логики.

## Технологический стек

*   **Язык:** C#
*   **Движок:** Unity (Клиент) / .NET Console App (Сервер)
*   **Сеть:** LiteNetLib
*   **Бэкенд:** PHP + SQLite (доступ к базе данных через HTTP-запросы)

## Ключевые особенности

### 1. Кастомный бинарный сериализатор (`ProtonStream`)
Вместо использования стандартных решений (JSON или встроенных сериализаторов C#), я написал собственную систему бинарной сериализации для минимизации размера пакетов и попытки разобраться в этом самостоятельно.

*   **ProtonStream:** Самописная обертка над массивом байтов. Вручную записывает и читает биты/байты для всех поддерживаемых типов (Int, Float, Bool, String).
*   **Сложные типы:** Система поддерживает рекурсивную сериализацию Списков (`List`), Словарей (`Dictionary`) и вложенных кастомных структур (`NetworkStructure`).
*   **Структура пакета:** Каждый пакет состоит из заголовка (ID), метаданных (при необходимости) и сериализованной нагрузки.

### 2. Собственная система RPC
Реализована система удаленного вызова Remote Procedure Call для общения между клиентом и сервером.

*   **Хеширование строк:** Для экономии трафика названия методов хешируются в целые числа, чтобы не пересылать строки по сети постоянно.
*   **Гибкие аргументы:** RPC могут принимать переменный список аргументов (`List<NetworkValue>`) любого поддерживаемого типа.
*   **Таргетинг:** RPC можно отправлять конкретным целям: `Server`, `All`, `Others` (всем, кроме отправителя) или конкретному `PlayerID`.

### 3. Архитектура сервера
Сервер представляет собой отдельное консольное приложение на C#, которое управляет всей логикой игры. Он не зависит от физики или логики Unity.

*   **Система PVar / SVar:** Система переменных (Player Var / Server Var), вдохновленная SA:MP сервером для управления переменными игрока (здоровье, деньги, работа) и сервера (Глобальные события).
*   **Игровая логика:** Сервер рассчитывает урон, управляет зелеными зонами (безопасные зоны без урона) и прогрессом работ.
*   **Tick System:** Сервер работает в бесконечном цикле, обрабатывая сетевые события и обновляя состояние игры 1000 раз в секунду.
*   **Интеграция с БД:** Сервер общается с веб-сервером через HTTP POST/GET запросы для сохранения и загрузки статистики игроков (Деньги, EXP, Позиция).

### 4. Реализация геймплея (RP Gamemode)
На базе движка я создал полностью функциональный Role Play режим:

*   **Экономика:** Работы (Шахтер, Водитель автобуса), система зарплат, магазины.
*   **Система событий:** Динамическое событие "Бомбардировка", где сервер спавнит самолеты и синхронизирует взрывы, заставляя игроков искать бункеры (координаты игроков также синхронизированы).
*   **Квесты:** Движок квестов с отслеживанием прогресса и сохранением в базу данных.
*   **Админ меню:** Команды для управления игроками, телепортации, кика/бана и запуска глобальных событий.

## Дисклеймер!

Этот проект был создан мной в образовательных целях в 2023 году, когда я имел малый опыт, поэтому код содержит не лучшие решения (магические значения, куча потоков, SQLite query через HTTP запросы). Сейчас бы я отказался от расточильного использования потоков, сделал бы асинхронные запросы и перешел на MySQL. Тем не менее, система работала стабильно и дала мне глубокое понимание того, как данные передаются по сети.

## Структура проекта

*   `server/Server` - Логика автономного сервера (Ядро, Гейммод, Сеть).
*   `client/ProtonEngine` - Скрипты Unity (Обработка пакетов, RPC).
